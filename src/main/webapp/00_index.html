<!DOCTYPE html>
<html>
<head>
<meta charset=UTF-8>
<link rel="stylesheet" href="https://www.w3schools.com/w3css/4/w3.css">
<link rel="stylesheet" href="css/style.css">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
<script src="https://cdn.jsdelivr.net/npm/vue/dist/vue.js"></script>
<script src="https://unpkg.com/axios/dist/axios.min.js"></script>
<script src="./script.js"></script>
<title>Main</title>
</head>
<body class="body">
    <div id="body-div">
       <nav-bar></nav-bar>
    
        <!-- 메인 -->
        <div class="main-container">

            <index></index>

            <foot></foot>
        </div>
    </div>

<!-- ========================================템플릿======================================== -->
    <template id="indexTemp">
        <div>
            <div class="w3-row">
                <div class="w3-col s6 w3-green w3-center">
                    <img src="./img/mainPicture.jpg" style="width:40%">
                </div>
                <div class="w3-col s6 w3-dark-grey w3-center">
                    <img src="./img/mainPicture.jpg" style="width:40%">
                </div>
            </div>

            <div class="w3-row" style="margin-top:50px; margin-bottom:100px;">
                <div class="w3-col w3-container" style="width:20%;"></div>
                <div class="w3-col w3-container" style="width:25%">
                    <div class="w3-panel w3-black" style="width:75%; float: left">공지사항</div>
                    <div style="margin-top: 6%;"><a href="03_notice.html"><h5>더 보기</h5></a></div>
                    <table class="w3-table w3-bordered w3-hoverable w3-centered w3-card-4">
                        <thead>
                        <tr style="background-color: #e7dcdc">
                            <th style="column-width: 5%">No</th>
                            <th style="column-width: 5%">작성자</th>
                            <th style="column-width: 85%">제목</th>
                            <th style="column-width: 5%">날짜</th>
                        </tr>
                        </thead>
                        <tr v-for="(notice, index) in notice_list" @click="viewNoticeOne(index)" style="cursor: pointer;">  <!-- ======공지사항 연동하기 =====-->
                            <td v-if="(index_max > notice) && (notice >= index_min)" style="column-width: 5%">{{}}</td>
                            <td v-if="(index_max > notice) && (notice >= index_min)" style="column-width: 85%">{{}}</td>
                            <td v-if="(index_max > notice) && (notice >= index_min)" style="column-width: 5%">{{}}</td>
                            <td v-if="(index_max > notice) && (notice >= index_min)" style="column-width: 5%">{{}}</td>
                        </tr>
                    </table>
                </div>
                <div class="w3-col w3-container" style="width:10%"></div>
                <div class="w3-col w3-container" style="width:25%">
                    <div class="w3-panel w3-black" style="width:75%; float: left;">자유게시판</div>
                    <div style="margin-top: 6%;"><a href="03_board.html"><h5>더 보기</h5></a></div>
                    <table class="w3-table w3-bordered w3-hoverable w3-centered w3-card-4">
                        <thead>
                        <tr style="background-color: #e7dcdc">
                            <th style="column-width: 50px">No</th>
                            <th style="column-width: 100px">작성자</th>
                            <th style="column-width: 150px">제목</th>
                            <th style="column-width: 50px">날짜</th>
                        </tr>
                        </thead>
                        <tr v-for="(board, index) in board_list" @click="viewBoardOne(index)" style="cursor: pointer;">
                            <td v-if="(index_max > index) && (index >= index_min)" style="column-width: 50px">{{board.id}}</td>
                            <td  v-if="(index_max > index) && (index >= index_min)" style="column-width: 100px">{{board.writer}}</td>
                            <td  v-if="(index_max > index) && (index >= index_min)" style="column-width: 150px">{{board.title}}</td>
                            <td  v-if="(index_max > index) && (index >= index_min)" style="column-width: 50px">{{board.created}}</td>
                        </tr>
                    </table>
                </div>
                <div class="w3-col w3-container" style="width:20%"></div>
            </div>
        </div>
    </template>
<script>
    Vue.component('index', {
    template: "#indexTemp",
    data: function() {
            return {
                notice_list: [],
                board_list: [],
                index_min: 0,
                index_max: 5
            }
        },
    created: function() {
            axios({
                    method: "get",
                    url: "http://localhost/board", 
                }).then(resData => {  
                    this.board_list = resData.data;
                }).catch(errorData => {
                    alert("게시글을 불러오는데 실패했습니다. 잠시 후 다시 시도해주세요")
                });
    },
    methods: {
            viewBoardOne: function(index) {
                console.log(index)
                if(index != null){
                    location.href = "03_01_view.html?id=" + this.board_list[index].id;
                }
                else{
                    alert("게시글을 불러오는데 실패했습니다. 잠시 후 다시 시도해주세요")
                }
            },
            viewNoticeOne: function(index) {
                console.log(index)
                if(index != null){
                    location.href = "03_01_view.html?id=" + this.board_list[index].id; //====공지사항 링크로 수정 필요====
                }
                else{
                    alert("게시글을 불러오는데 실패했습니다. 잠시 후 다시 시도해주세요")
                }
            }
        }
    })

// ========================================공통 스크립트========================================

navBar(); // 컴포넌트 내부에서 실행하면 navBar 변수를 템플릿으로 가져오지 못함 (템플릿이 먼저 구성되고 created함수가 실행되는 원리인듯?)
footer();    

    Vue.component('nav-bar', {
        template: navBarScript,
        data: function() {
                return {
                    login,
                    logout
                }
            },
        methods: {
            ClickLogout: function(){
                sessionStorage.setItem("token", null);
                this.login = false;
                this.logout = true;
                alert("로그아웃 했습니다");
                location.href="00_index.html";
            }
        }
    })
    Vue.component('foot', {
        template: footerScript,
    })

    new Vue({
        el: "#body-div",
        data: {
            model: {
                showIndex: true,
                showLogin: false
            }
        }
    })

</script>

    
</body>
</html>