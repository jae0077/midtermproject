<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<link rel="stylesheet" href="https://www.w3schools.com/w3css/4/w3.css">
<link rel="stylesheet" href="css/style.css">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
<script src="https://cdn.jsdelivr.net/npm/vue/dist/vue.js"></script>
<script src="https://unpkg.com/axios/dist/axios.min.js"></script>
<script src="./script.js"></script>
<title>Seat</title>
</head>
<body class="body">
    <div id="body-div">
        <nav-bar></nav-bar>
        
        <!-- 메인 -->
        <div class="main-container">
            <seat-select></seat-select>


            <foot></foot>
        </div>
    </div>


    <!-- ========================================== 템플릿 ================================================ -->
<template id="seatSelect">
    <div class="sub-container">
        <h1>좌석 선택</h1><hr>
        <div>
            전체 : 
            /잔여 : 
            선택 가능한 좌석은 초록색으로 표시됩니다.{{checkSeat()}}<br>
        </div>
        <div style="border-style: groove; width: 90%; height: 90%; margin-top: 2%; margin-left: 5%;">
            <div style="padding: 1%; display: flex; width: 100%;">
                <div class="square" style="padding: 10px; margin-left: 10px;">
                    <!-- <div id="seat00" class="square" @click="selectSeat('seat01')"></div> -->
                    <div id="seat1" class="content" onclick="ajaxReq(1)">1</div>
                </div>
                <div class="square" style="padding: 10px; margin-left: 10px;">
                    <div id="seat2" class="content" onclick="ajaxReq(2)">2</div>
                </div>
                <div class="square" style="padding: 10px; margin-left: 10px;">
                    <div id="seat3" class="content" onclick="ajaxReq(3)">3</div>
                </div>
                <div class="square" style="padding: 10px; margin-left: 10px;">
                    <div id="seat4" class="content" onclick="ajaxReq(4)">4</div>
                </div>
                <div class="square" style="padding: 10px; margin-left: 10px;">
                    <div id="seat5" class="content" onclick="ajaxReq(5)">5</div>
                </div>
                <div class="square" style="padding: 10px; margin-left: 10px;">
                    <div id="seat6" class="content">6</div>
                </div> 
                
                <div style="width: 5%; background-color: rgb(255, 255, 255);"></div>

                <div class="square" style="padding: 10px; margin-left: 10px;">
                    <div id="seat7" class="content"></div>
                </div>
                <div class="square" style="padding: 10px; margin-left: 10px;">
                    <div id="seat8" class="content"></div>
                </div>
                <div class="square" style="padding: 10px; margin-left: 10px;">
                    <div id="seat9" class="content"></div>
                </div>
                <div class="square" style="padding: 10px; margin-left: 10px;">
                    <div id="seat10" class="content"></div>
                </div>
                <div class="square" style="padding: 10px; margin-left: 10px;">
                    <div id="seat11" class="content"></div>
                </div>
                <div class="square" style="padding: 10px; margin-left: 10px;">
                    <div id="seat12" class="content"></div>
                </div> 
            </div>

            <div style="padding: 1%; display: flex; width: 100%;">
                <div class="square" style="padding: 10px; margin-left: 10px;">
                    <div id="seat13" class="content"></div>
                </div>
                <div class="square" style="padding: 10px; margin-left: 10px;">
                    <div id="seat14" class="content"></div>
                </div>
                <div class="square" style="padding: 10px; margin-left: 10px;">
                    <div id="seat15" class="content"></div>
                </div>
                <div class="square" style="padding: 10px; margin-left: 10px;">
                    <div id="seat16" class="content"></div>
                </div>
                <div class="square" style="padding: 10px; margin-left: 10px;">
                    <div id="seat17" class="content"></div>
                </div>
                <div class="square" style="padding: 10px; margin-left: 10px;">
                    <div id="seat18" class="content"></div>
                </div> 
                
                <div style="width: 5%; background-color: rgb(255, 255, 255);"></div>
                
                <div class="square" style="padding: 10px; margin-left: 10px;">
                    <div id="seat19" class="content"></div>
                </div>
                <div class="square" style="padding: 10px; margin-left: 10px;">
                    <div id="seat20" class="content"></div>
                </div>
                <div class="square" style="padding: 10px; margin-left: 10px;">
                    <div id="seat21" class="content"></div>
                </div>
                <div class="square" style="padding: 10px; margin-left: 10px;">
                    <div id="seat22" class="content"></div>
                </div>
                <div class="square" style="padding: 10px; margin-left: 10px;">
                    <div id="seat23" class="content"></div>
                </div>
                <div class="square" style="padding: 10px; margin-left: 10px;">
                    <div id="seat24" class="content"></div>
                </div> 
            </div>
        </div>
    </div>
</template>

<div id="select" class="w3-modal w3-animate-opacity">
	<div class="w3-modal-content" style="padding: 32px; text-align: center;">
		<div class="w3-container" >
			<i onclick="document.getElementById('select').style.display='none'" class="fa fa-remove w3-transparent w3-button w3-xlarge w3-right"></i>
			<h2 id="s" ></h2>
			<button style="width: 100px;" onclick="yes()">네</button> 
			<button style="width: 100px;" onclick="document.getElementById('select').style.display='none'">아니오</button>
		</div>
	</div>
</div>

<script>
	seatIdx = 0;

	function ajaxReq(v){
	    axios.get("seat/check/"+v)
	    .then(resData => {
			if(resData.data){
				alert("선택 불가");
			}else{
				document.getElementById('select').style.display='block';
				document.getElementById('s').textContent=v+"번 좌석을 선택하시겠습니까?";
				seatIdx = v;
			}
	    }).catch(error => {
			console.log("비정상 응답 ", error);
	    });
	}
	
	function yes(){
		alert(seatIdx);
	}
	
    navBar(); // 컴포넌트 내부에서 실행하면 navBar 변수를 템플릿으로 가져오지 못함 (템플릿이 먼저 구성되고 created함수가 실행되는 원리인듯?)
    footer();    
    Vue.component('seat-select', {
        template: "#seatSelect",
        data: function(){
            return{
                seat : "",
                using : false
            }
        },
        methods:{
        	checkSeat : function(){
        		axios({
        			method: "get",
        			url: "seat1"
        		}).then(resData => {
        			datas = resData.data;
        			for(let s of datas){
        				if(s.isUsed == "1"){
        					document.getElementById("seat"+s.seatIdx).style.backgroundColor='rgb(221, 61, 61)';
        				}
        			}
        		}).catch(errorData => {
        			alert(errorData);
        		});
            },
            selectSeat: function(v){
                this.using = false; // DB에서 좌석이 사용중인지 불린값을 가져와서 비교
                if(this.using == false){
                    this.seat = v; //시트값을 저장하고 
                    using = true; //사용중으로 불린값 변경 후 DB에 전송
                    document.getElementById('seat00').style.backgroundColor='rgb(221, 61, 61)';
                }

            }
        }

    })



// ==================================================공통=========================================
    navBar(); // 컴포넌트 내부에서 실행하면 navBar 변수를 템플릿으로 가져오지 못함 (템플릿이 먼저 구성되고 created함수가 실행되는 원리인듯?)
    footer();    

    Vue.component('nav-bar', {
        template: navBarScript,
        data: function() {
                return {
                    login,
                    logout,
                }
            },
        methods: {
            ClickLogout: function(){
                sessionStorage.setItem("token", null);
                this.login = false;
                this.logout = true;
                alert("로그아웃 했습니다");
                location.href="00_index.html";
            }
        }
    })
    Vue.component('foot', {
        template: footerScript,
    })

    new Vue({
        el: "#body-div",

        data: {
            model: {
                showIndex: true,
                showLogin: false
            }
        },
        methods: {
            test: function(){
                console.log("12");
            }
        }
    });
    
    new Vue({
        el: "#select",
        data: {
            seatIdx: 0
        },
        methods: {
            seat: function(v){
                console.log(v);
            }
        }
    });

</script>
</body>
</html>